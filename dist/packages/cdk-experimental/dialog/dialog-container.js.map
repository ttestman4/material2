{"version":3,"file":"dialog-container.js","sourceRoot":"","sources":["../../../../src/cdk-experimental/dialog/dialog-container.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {animate, AnimationEvent, state, style, transition, trigger} from '@angular/animations';\nimport {FocusTrapFactory} from '@angular/cdk/a11y';\nimport {\n  BasePortalOutlet,\n  ComponentPortal,\n  PortalHostDirective,\n  TemplatePortal\n} from '@angular/cdk/portal';\nimport {DOCUMENT} from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ComponentRef,\n  ElementRef,\n  EmbeddedViewRef,\n  HostBinding,\n  Inject,\n  OnDestroy,\n  Optional,\n  ViewChild,\n  ViewEncapsulation,\n} from '@angular/core';\nimport {Subject} from 'rxjs';\nimport {distinctUntilChanged} from 'rxjs/operators';\nimport {DialogConfig} from './dialog-config';\n\n\nexport function throwDialogContentAlreadyAttachedError() {\n  throw Error('Attempting to attach dialog content after content is already attached');\n}\n\n\n/**\n * Internal component that wraps user-provided dialog content.\n * @docs-private\n */\n@Component({\n  moduleId: module.id,\n  selector: 'cdk-dialog-container',\n  templateUrl: './dialog-container.html',\n  styleUrls: ['dialog-container.css'],\n  encapsulation: ViewEncapsulation.None,\n  // Using OnPush for dialogs caused some G3 sync issues. Disabled until we can track them down.\n  // tslint:disable-next-line:validate-decorators\n  changeDetection: ChangeDetectionStrategy.Default,\n  animations: [\n    trigger('dialog', [\n      state('enter', style({opacity: 1})),\n      state('exit, void', style({opacity: 0})),\n      transition('* => enter', animate('{{enterAnimationDuration}}')),\n      transition('* => exit, * => void', animate('{{exitAnimationDuration}}')),\n    ])\n  ],\n  host: {\n    '[@dialog]': `{\n      value: _state,\n      params: {\n        enterAnimationDuration: _config.enterAnimationDuration,\n        exitAnimationDuration: _config.exitAnimationDuration\n      }\n    }`,\n    '(@dialog.start)': '_onAnimationStart($event)',\n    '(@dialog.done)': '_animationDone.next($event)',\n  },\n})\nexport class CdkDialogContainer extends BasePortalOutlet implements OnDestroy {\n  /** State of the dialog animation. */\n  _state: 'void' | 'enter' | 'exit' = 'enter';\n\n  /** Element that was focused before the dialog was opened. Save this to restore upon close. */\n  private _elementFocusedBeforeDialogWasOpened: HTMLElement | null = null;\n\n   /** The class that traps and manages focus within the dialog. */\n  private _focusTrap = this._focusTrapFactory.create(this._elementRef.nativeElement, false);\n\n  // @HostBinding is used in the class as it is expected to be extended.  Since @Component decorator\n  // metadata is not inherited by child classes, instead the host binding data is defined in a way\n  // that can be inherited.\n  // tslint:disable:no-host-decorator-in-concrete\n  @HostBinding('attr.aria-label') get _ariaLabel() { return this._config.ariaLabel || null; }\n\n  @HostBinding('attr.aria-describedby')\n  get _ariaDescribedBy() { return this._config.ariaDescribedBy; }\n\n  @HostBinding('attr.role') get _role() { return this._config.role; }\n\n  @HostBinding('attr.tabindex') get _tabindex() { return -1; }\n  // tslint:disable:no-host-decorator-in-concrete\n\n  /** The portal host inside of this container into which the dialog content will be loaded. */\n  @ViewChild(PortalHostDirective) _portalHost: PortalHostDirective;\n\n  /** A subject emitting before the dialog enters the view. */\n  _beforeEnter: Subject<void> = new Subject();\n\n  /** A subject emitting after the dialog enters the view. */\n  _afterEnter: Subject<void> = new Subject();\n\n  /** A subject emitting before the dialog exits the view. */\n  _beforeExit: Subject<void> = new Subject();\n\n  /** A subject emitting after the dialog exits the view. */\n  _afterExit: Subject<void> = new Subject();\n\n  /** Stream of animation `done` events. */\n  _animationDone = new Subject<AnimationEvent>();\n\n  constructor(\n    private _elementRef: ElementRef<HTMLElement>,\n    private _focusTrapFactory: FocusTrapFactory,\n    private _changeDetectorRef: ChangeDetectorRef,\n    @Optional() @Inject(DOCUMENT) private _document: any,\n    /** The dialog configuration. */\n    public _config: DialogConfig) {\n    super();\n\n    // We use a Subject with a distinctUntilChanged, rather than a callback attached to .done,\n    // because some browsers fire the done event twice and we don't want to emit duplicate events.\n    // See: https://github.com/angular/angular/issues/24084\n    this._animationDone.pipe(distinctUntilChanged((x, y) => {\n      return x.fromState === y.fromState && x.toState === y.toState;\n    })).subscribe(event => {\n      // Emit lifecycle events based on animation `done` callback.\n      if (event.toState === 'enter') {\n        this._autoFocusFirstTabbableElement();\n        this._afterEnter.next();\n        this._afterEnter.complete();\n      }\n\n      if (event.fromState === 'enter' && (event.toState === 'void' || event.toState === 'exit')) {\n        this._returnFocusAfterDialog();\n        this._afterExit.next();\n        this._afterExit.complete();\n      }\n    });\n  }\n\n  /** Destroy focus trap to place focus back to the element focused before the dialog opened. */\n  ngOnDestroy() {\n    this._focusTrap.destroy();\n    this._animationDone.complete();\n  }\n\n  /**\n   * Attach a ComponentPortal as content to this dialog container.\n   * @param portal Portal to be attached as the dialog content.\n   */\n  attachComponentPortal<T>(portal: ComponentPortal<T>): ComponentRef<T> {\n    if (this._portalHost.hasAttached()) {\n      throwDialogContentAlreadyAttachedError();\n    }\n\n    this._savePreviouslyFocusedElement();\n    return this._portalHost.attachComponentPortal(portal);\n  }\n\n  /**\n   * Attach a TemplatePortal as content to this dialog container.\n   * @param portal Portal to be attached as the dialog content.\n   */\n  attachTemplatePortal<C>(portal: TemplatePortal<C>): EmbeddedViewRef<C> {\n    if (this._portalHost.hasAttached()) {\n      throwDialogContentAlreadyAttachedError();\n    }\n\n    this._savePreviouslyFocusedElement();\n    return this._portalHost.attachTemplatePortal(portal);\n  }\n\n  /** Emit lifecycle events based on animation `start` callback. */\n  _onAnimationStart(event: AnimationEvent) {\n    if (event.toState === 'enter') {\n      this._beforeEnter.next();\n      this._beforeEnter.complete();\n    }\n    if (event.fromState === 'enter' && (event.toState === 'void' || event.toState === 'exit')) {\n      this._beforeExit.next();\n      this._beforeExit.complete();\n    }\n  }\n\n  /** Starts the dialog exit animation. */\n  _startExiting(): void {\n    this._state = 'exit';\n\n    // Mark the container for check so it can react if the\n    // view container is using OnPush change detection.\n    this._changeDetectorRef.markForCheck();\n  }\n\n  /** Saves a reference to the element that was focused before the dialog was opened. */\n  private _savePreviouslyFocusedElement() {\n    if (this._document) {\n      this._elementFocusedBeforeDialogWasOpened = this._document.activeElement as HTMLElement;\n\n      // Move focus onto the dialog immediately in order to prevent the user from accidentally\n      // opening multiple dialogs at the same time. Needs to be async, because the element\n      // may not be focusable immediately.\n      Promise.resolve().then(() => this._elementRef.nativeElement.focus());\n    }\n  }\n\n  /**\n   * Autofocus the first tabbable element inside of the dialog, if there is not a tabbable element,\n   * focus the dialog instead.\n   */\n  private _autoFocusFirstTabbableElement() {\n    // If were to attempt to focus immediately, then the content of the dialog would not yet be\n    // ready in instances where change detection has to run first. To deal with this, we simply\n    // wait for the microtask queue to be empty.\n    if (this._config.autoFocus) {\n      this._focusTrap.focusInitialElementWhenReady().then(hasMovedFocus => {\n        // If we didn't find any focusable elements inside the dialog, focus the\n        // container so the user can't tab into other elements behind it.\n        if (!hasMovedFocus) {\n          this._elementRef.nativeElement.focus();\n        }\n      });\n    }\n  }\n\n  /** Returns the focus to the element focused before the dialog was open. */\n  private _returnFocusAfterDialog() {\n    const toFocus = this._elementFocusedBeforeDialogWasOpened;\n    // We need the extra check, because IE can set the `activeElement` to null in some cases.\n    if (toFocus && typeof toFocus.focus === 'function') {\n      toFocus.focus();\n    }\n  }\n}\n"]}