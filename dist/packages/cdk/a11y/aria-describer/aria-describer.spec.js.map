{"version":3,"file":"aria-describer.spec.js","sourceRoot":"","sources":["../../../../../src/cdk/a11y/aria-describer/aria-describer.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import {A11yModule, CDK_DESCRIBEDBY_HOST_ATTRIBUTE} from '../index';\nimport {AriaDescriber, MESSAGES_CONTAINER_ID} from './aria-describer';\nimport {async, ComponentFixture, TestBed} from '@angular/core/testing';\nimport {Component, ElementRef, ViewChild} from '@angular/core';\n\ndescribe('AriaDescriber', () => {\n  let ariaDescriber: AriaDescriber;\n  let component: TestApp;\n  let fixture: ComponentFixture<TestApp>;\n\n  beforeEach(async(() => {\n    TestBed.configureTestingModule({\n      imports: [A11yModule],\n      declarations: [TestApp],\n      providers: [AriaDescriber],\n    }).compileComponents();\n  }));\n\n  beforeEach(() => {\n    fixture = TestBed.createComponent(TestApp);\n    component = fixture.componentInstance;\n    ariaDescriber = component.ariaDescriber;\n  });\n\n  afterEach(() => {\n    ariaDescriber.ngOnDestroy();\n  });\n\n  it('should initialize without the message container', () => {\n    expect(getMessagesContainer()).toBeNull();\n  });\n\n  it('should be able to create a message element', () => {\n    ariaDescriber.describe(component.element1, 'My Message');\n    expectMessages(['My Message']);\n  });\n\n  it('should not register empty strings', () => {\n    ariaDescriber.describe(component.element1, '');\n    expect(getMessageElements()).toBe(null);\n  });\n\n  it('should not register non-string values', () => {\n    expect(() => ariaDescriber.describe(component.element1, null!)).not.toThrow();\n    expect(getMessageElements()).toBe(null);\n  });\n\n  it('should not throw when trying to remove non-string value', () => {\n    expect(() => ariaDescriber.removeDescription(component.element1, null!)).not.toThrow();\n  });\n\n  it('should de-dupe a message registered multiple times', () => {\n    ariaDescriber.describe(component.element1, 'My Message');\n    ariaDescriber.describe(component.element2, 'My Message');\n    ariaDescriber.describe(component.element3, 'My Message');\n    expectMessages(['My Message']);\n    expectMessage(component.element1, 'My Message');\n    expectMessage(component.element2, 'My Message');\n    expectMessage(component.element3, 'My Message');\n  });\n\n  it('should be able to register multiple messages', () => {\n    ariaDescriber.describe(component.element1, 'First Message');\n    ariaDescriber.describe(component.element2, 'Second Message');\n    expectMessages(['First Message', 'Second Message']);\n    expectMessage(component.element1, 'First Message');\n    expectMessage(component.element2, 'Second Message');\n  });\n\n  it('should be able to unregister messages', () => {\n    ariaDescriber.describe(component.element1, 'My Message');\n    expectMessages(['My Message']);\n\n    // Register again to check dedupe\n    ariaDescriber.describe(component.element2, 'My Message');\n    expectMessages(['My Message']);\n\n    // Unregister one message and make sure the message is still present in the container\n    ariaDescriber.removeDescription(component.element1, 'My Message');\n    expect(component.element1.hasAttribute(CDK_DESCRIBEDBY_HOST_ATTRIBUTE)).toBeFalsy();\n    expectMessages(['My Message']);\n\n    // Unregister the second message, message container should be gone\n    ariaDescriber.removeDescription(component.element2, 'My Message');\n    expect(component.element2.hasAttribute(CDK_DESCRIBEDBY_HOST_ATTRIBUTE)).toBeFalsy();\n    expect(getMessagesContainer()).toBeNull();\n  });\n\n  it('should be able to unregister messages while having others registered', () => {\n    ariaDescriber.describe(component.element1, 'Persistent Message');\n    ariaDescriber.describe(component.element2, 'My Message');\n    expectMessages(['Persistent Message', 'My Message']);\n\n    // Register again to check dedupe\n    ariaDescriber.describe(component.element3, 'My Message');\n    expectMessages(['Persistent Message', 'My Message']);\n\n    // Unregister one message and make sure the message is still present in the container\n    ariaDescriber.removeDescription(component.element2, 'My Message');\n    expectMessages(['Persistent Message', 'My Message']);\n\n    // Unregister the second message, message container should be gone\n    ariaDescriber.removeDescription(component.element3, 'My Message');\n    expectMessages(['Persistent Message']);\n  });\n\n  it('should be able to append to an existing list of aria describedby', () => {\n    ariaDescriber.describe(component.element4, 'My Message');\n    expectMessages(['My Message']);\n    expectMessage(component.element4, 'My Message');\n  });\n\n  it('should be able to handle multiple regisitrations of the same message to an element', () => {\n    ariaDescriber.describe(component.element1, 'My Message');\n    ariaDescriber.describe(component.element1, 'My Message');\n    expectMessages(['My Message']);\n    expectMessage(component.element1, 'My Message');\n  });\n\n  it('should not throw when attempting to describe a non-element node', () => {\n    const node: any = document.createComment('Not an element node');\n    expect(() => ariaDescriber.describe(node, 'This looks like an element')).not.toThrow();\n  });\n\n  it('should clear any pre-existing containers', () => {\n    const extraContainer = document.createElement('div');\n    extraContainer.id = MESSAGES_CONTAINER_ID;\n    document.body.appendChild(extraContainer);\n\n    ariaDescriber.describe(component.element1, 'Hello');\n\n    // Use `querySelectorAll` with an attribute since `getElementById` will stop at the first match.\n    expect(document.querySelectorAll(`[id='${MESSAGES_CONTAINER_ID}']`).length).toBe(1);\n  });\n});\n\nfunction getMessagesContainer() {\n  return document.querySelector(`#${MESSAGES_CONTAINER_ID}`);\n}\n\nfunction getMessageElements(): Node[] | null {\n  const messagesContainer = getMessagesContainer();\n  if (!messagesContainer) { return null; }\n\n  return messagesContainer ?  Array.prototype.slice.call(messagesContainer.children) : null;\n}\n\n/** Checks that the messages array matches the existing created message elements. */\nfunction expectMessages(messages: string[]) {\n  const messageElements = getMessageElements();\n  expect(messageElements).toBeDefined();\n\n  expect(messages.length).toBe(messageElements!.length);\n  messages.forEach((message, i) => {\n    expect(messageElements![i].textContent).toBe(message);\n  });\n}\n\n/** Checks that an element points to a message element that contains the message. */\nfunction expectMessage(el: Element, message: string) {\n  const ariaDescribedBy = el.getAttribute('aria-describedby');\n  expect(ariaDescribedBy).toBeDefined();\n\n  const cdkDescribedBy = el.getAttribute(CDK_DESCRIBEDBY_HOST_ATTRIBUTE);\n  expect(cdkDescribedBy).toBeDefined();\n\n  const messages = ariaDescribedBy!.split(' ').map(referenceId => {\n    const messageElement = document.querySelector(`#${referenceId}`);\n    return messageElement ? messageElement.textContent : '';\n  });\n\n  expect(messages).toContain(message);\n}\n\n@Component({\n  template: `\n    <div #element1></div>\n    <div #element2></div>\n    <div #element3></div>\n    <div #element4 aria-describedby=\"existing-aria-describedby1 existing-aria-describedby2\"></div>\n  `,\n})\nclass TestApp {\n  @ViewChild('element1') _element1: ElementRef<HTMLElement>;\n  get element1(): Element { return this._element1.nativeElement; }\n\n  @ViewChild('element2') _element2: ElementRef<HTMLElement>;\n  get element2(): Element { return this._element2.nativeElement; }\n\n  @ViewChild('element3') _element3: ElementRef<HTMLElement>;\n  get element3(): Element { return this._element3.nativeElement; }\n\n  @ViewChild('element4') _element4: ElementRef<HTMLElement>;\n  get element4(): Element { return this._element4.nativeElement; }\n\n\n  constructor(public ariaDescriber: AriaDescriber) { }\n}\n"]}