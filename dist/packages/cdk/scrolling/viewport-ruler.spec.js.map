{"version":3,"file":"viewport-ruler.spec.js","sourceRoot":"","sources":["../../../../src/cdk/scrolling/viewport-ruler.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import {TestBed, inject, fakeAsync, tick} from '@angular/core/testing';\nimport {ScrollingModule} from './public-api';\nimport {ViewportRuler} from './viewport-ruler';\nimport {dispatchFakeEvent} from '@angular/cdk/testing';\nimport {NgZone} from '@angular/core';\n\n// For all tests, we assume the browser window is 1024x786 (outerWidth x outerHeight).\n// The karma config has been set to this for local tests, and it is the default size\n// for tests on CI (both SauceLabs and Browserstack).\n\n// While we know the *outer* window width/height, the innerWidth and innerHeight depend on the\n// the size of the individual browser's chrome, so we have to use window.innerWidth and\n// window.innerHeight in the unit test instead of hard-coded values.\n\ndescribe('ViewportRuler', () => {\n  let ruler: ViewportRuler;\n\n  let startingWindowWidth = window.innerWidth;\n  let startingWindowHeight = window.innerHeight;\n\n  // Create a very large element that will make the page scrollable.\n  let veryLargeElement: HTMLElement = document.createElement('div');\n  veryLargeElement.style.width = '6000px';\n  veryLargeElement.style.height = '6000px';\n\n  beforeEach(() => TestBed.configureTestingModule({\n    imports: [ScrollingModule],\n    providers: [ViewportRuler]\n  }));\n\n  beforeEach(inject([ViewportRuler], (viewportRuler: ViewportRuler) => {\n    ruler = viewportRuler;\n    scrollTo(0, 0);\n  }));\n\n  afterEach(() => {\n    ruler.ngOnDestroy();\n  });\n\n  it('should get the viewport size', () => {\n    let size = ruler.getViewportSize();\n    expect(size.width).toBe(window.innerWidth);\n    expect(size.height).toBe(window.innerHeight);\n  });\n\n  it('should get the viewport bounds when the page is not scrolled', () => {\n    let bounds = ruler.getViewportRect();\n    expect(bounds.top).toBe(0);\n    expect(bounds.left).toBe(0);\n    expect(bounds.bottom).toBe(window.innerHeight);\n    expect(bounds.right).toBe(window.innerWidth);\n  });\n\n  it('should get the viewport bounds when the page is scrolled', () => {\n    document.body.appendChild(veryLargeElement);\n\n    scrollTo(1500, 2000);\n\n    let bounds = ruler.getViewportRect();\n\n    // In the iOS simulator (BrowserStack & SauceLabs), adding the content to the\n    // body causes karma's iframe for the test to stretch to fit that content once we attempt to\n    // scroll the page. Setting width / height / maxWidth / maxHeight on the iframe does not\n    // successfully constrain its size. As such, skip assertions in environments where the\n    // window size has changed since the start of the test.\n    if (window.innerWidth > startingWindowWidth || window.innerHeight > startingWindowHeight) {\n      document.body.removeChild(veryLargeElement);\n      return;\n    }\n\n    expect(bounds.top).toBe(2000);\n    expect(bounds.left).toBe(1500);\n    expect(bounds.bottom).toBe(2000 + window.innerHeight);\n    expect(bounds.right).toBe(1500 + window.innerWidth);\n\n    document.body.removeChild(veryLargeElement);\n  });\n\n  it('should get the bounds based on client coordinates when the page is pinch-zoomed', () => {\n    // There is no API to make the browser pinch-zoom, so there's no real way to automate\n    // tests for this behavior. Leaving this test here as documentation for the behavior.\n  });\n\n  it('should get the scroll position when the page is not scrolled', () => {\n    let scrollPos = ruler.getViewportScrollPosition();\n    expect(scrollPos.top).toBe(0);\n    expect(scrollPos.left).toBe(0);\n  });\n\n  it('should get the scroll position when the page is scrolled', () => {\n    document.body.appendChild(veryLargeElement);\n\n    scrollTo(1500, 2000);\n\n    // In the iOS simulator (BrowserStack & SauceLabs), adding the content to the\n    // body causes karma's iframe for the test to stretch to fit that content once we attempt to\n    // scroll the page. Setting width / height / maxWidth / maxHeight on the iframe does not\n    // successfully constrain its size. As such, skip assertions in environments where the\n    // window size has changed since the start of the test.\n    if (window.innerWidth > startingWindowWidth || window.innerHeight > startingWindowHeight) {\n      document.body.removeChild(veryLargeElement);\n      return;\n    }\n\n    let scrollPos = ruler.getViewportScrollPosition();\n    expect(scrollPos.top).toBe(2000);\n    expect(scrollPos.left).toBe(1500);\n\n    document.body.removeChild(veryLargeElement);\n  });\n\n  describe('changed event', () => {\n    it('should dispatch an event when the window is resized', () => {\n      const spy = jasmine.createSpy('viewport changed spy');\n      const subscription = ruler.change(0).subscribe(spy);\n\n      dispatchFakeEvent(window, 'resize');\n      expect(spy).toHaveBeenCalled();\n      subscription.unsubscribe();\n    });\n\n    it('should dispatch an event when the orientation is changed', () => {\n      const spy = jasmine.createSpy('viewport changed spy');\n      const subscription = ruler.change(0).subscribe(spy);\n\n      dispatchFakeEvent(window, 'orientationchange');\n      expect(spy).toHaveBeenCalled();\n      subscription.unsubscribe();\n    });\n\n    it('should be able to throttle the callback', fakeAsync(() => {\n      const spy = jasmine.createSpy('viewport changed spy');\n      const subscription = ruler.change(1337).subscribe(spy);\n\n      dispatchFakeEvent(window, 'resize');\n      expect(spy).not.toHaveBeenCalled();\n\n      tick(1337);\n\n      expect(spy).toHaveBeenCalledTimes(1);\n      subscription.unsubscribe();\n    }));\n\n    it('should run the resize event outside the NgZone', () => {\n      const spy = jasmine.createSpy('viewport changed spy');\n      const subscription = ruler.change(0).subscribe(() => spy(NgZone.isInAngularZone()));\n\n      dispatchFakeEvent(window, 'resize');\n      expect(spy).toHaveBeenCalledWith(false);\n      subscription.unsubscribe();\n    });\n\n  });\n});\n"]}